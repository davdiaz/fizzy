default: &default
  # CAMBIO 1: Cambiar el adaptador de 'trilogy' a 'mysql2'
  adapter: mysql2
  
  # CAMBIO 2: Usar las variables de Render (DB_) en lugar de las variables de Fizzy (MYSQL_)
  host: <%= ENV.fetch("DB_HOST", "127.0.0.1") %>
  port: <%= ENV.fetch("DB_PORT", "4000") %> # 4000 es el puerto de TiDB
  username: <%= ENV.fetch("DB_USER", "root") %>
  password: <%= ENV.fetch("DB_PASSWORD", ENV["MYSQL_PASSWORD"]) %> # Usamos DB_PASSWORD
  pool: <%= ENV.fetch("RAILS_MAX_THREADS", 5) %> # Usamos RAILS_MAX_THREADS
  timeout: 5000

# development y test usan 'default' y heredarán las variables DB_
development:
  primary:
    <<: *default
    database: fizzy_development
  cable:
    <<: *default
    database: fizzy_development_cable
    migrations_paths: db/cable_migrate

test:
  primary:
    <<: *default
    database: fizzy_test
  cable:
    <<: *default
    database: fizzy_test_cable
    migrations_paths: db/cable_migrate

# Sección de Producción: Ahora solo hereda de 'default' y anula lo necesario (nada en este caso)
production:
  primary:
    <<: *default
    database: <%= ENV.fetch("DB_NAME", "fizzy_production") %> # Usa DB_NAME y valor por defecto
  
  # cable, queue, cache también usan *default, lo cual hereda la configuración DB_HOST
  cable:
    <<: *default
    database: fizzy_production_cable
    migrations_paths: db/cable_migrate
  queue:
    <<: *default
    database: fizzy_production_queue
    migrations_paths: db/queue_migrate
  cache:
    <<: *default
    database: fizzy_production_cache
    migrations_paths: db/cache_migrate
